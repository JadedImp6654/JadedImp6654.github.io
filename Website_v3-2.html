<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Entspannungsstudie</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
:root{
  --bg:#f4f6fb;
  --card:#fff;
  --accent:#2563eb;
  --text:#111827;
  --muted:#6b7280;
}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,system-ui,sans-serif;background:var(--bg);color:var(--text);}
nav{background:#fff;padding:16px 40px;border-bottom:1px solid #e5e7eb;display:flex;gap:32px;}
nav a{cursor:pointer;font-weight:600;text-decoration:none;color:var(--text);}
nav a:hover{color:var(--accent);}
.container{max-width:900px;margin:50px auto;padding:0 20px;}
.card{background:var(--card);padding:40px;border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.08);animation:fade .4s ease;}
@keyframes fade{from{opacity:0;transform:translateY(15px)}to{opacity:1;transform:none}}
button{margin-top:30px;padding:14px 30px;border:none;border-radius:10px;background:var(--accent);color:white;font-size:16px;cursor:pointer;}
button:disabled{background:#9ca3af;cursor:not-allowed;}
input[type=password], input[type=email]{width:100%;padding:14px;font-size:16px;border-radius:8px;border:1px solid #d1d5db;margin-top:10px;}
label{display:block;margin:10px 0;}
.progress{height:12px;background:#e5e7eb;border-radius:10px;overflow:hidden;margin-bottom:10px;}
.progress div{height:100%;width:0%;background:var(--accent);transition:.4s;}
.survey-step{display:none}
.survey-step.active{display:block}
video{width:100%;border-radius:14px;margin-top:20px}
ul{padding-left:18px}
input[type=text]{width:100%;padding:6px;border-radius:6px;border:1px solid #d1d5db;margin-top:5px;}
hr{margin:20px 0;border:none;border-top:1px solid #e5e7eb;}
</style>
</head>
<body>

<!-- CODE & E-MAIL -->
<div class="container" id="codeScreen">
  <div class="card">
    <h2>Zugriffscode</h2>
    <input id="codeInput" type="password" placeholder="Code eingeben">
    <button onclick="checkCode()">Weiter mit Code</button>
    <hr>
    <h3>Nur E-Mail senden</h3>
    <input id="emailInput" type="email" placeholder="Ihre E-Mail">
    <button onclick="sendEmailOnly()">E-Mail senden</button>
  </div>
</div>

<!-- APP -->
<div id="app" style="display:none">

<nav>
  <a onclick="showPage('start')">Startseite</a>
  <a onclick="showPage('downloads')">Downloads</a>
  <a onclick="startSurvey()">Umfrage</a>
</nav>

<div class="container">

<!-- DSGVO -->
<div id="consent" class="card" style="display:none">
  <h2>Einwilligung zur Teilnahme</h2>
  <p>
    Sie nehmen an einer wissenschaftlichen Studie zur Wirkung von Musik und Bildern auf Entspannung teil.
    Ihre Antworten werden pseudonym gespeichert. Timestamps und IP-Adresse werden erfasst.
    Die Teilnahme ist freiwillig und kann jederzeit abgebrochen werden.
    Kontakt: <strong>darian@mueller-gorges.de</strong>
  </p>
  <label><input type="checkbox" id="consentCheck"> Ich habe die Hinweise gelesen und willige ein.</label>
  <button onclick="acceptConsent()" id="consentBtn" disabled>Weiter zur Umfrage</button>
</div>

<!-- Startseite -->
<div id="start" class="card" style="display:none">
  <h2>Willkommen zur Studie</h2>
  <p>Vielen Dank für Ihre Teilnahme an der Untersuchung zur Wirkung von Musik und Bild auf Entspannung.</p>
</div>

<!-- Downloads -->
<div id="downloads" class="card" style="display:none">
  <h2>Downloads</h2>
  <ul>
    <li><a href="anleitung.txt" download>Anleitung herunterladen</a></li>
    <li><a href="erklärung.txt" download>Erklärung herunterladen</a></li>
    <li><a href="entspannungsfilm.mov" download>Entspannungsfilm herunterladen</a></li>
  </ul>
</div>

<!-- Survey -->
<div id="survey" style="display:none">
<div class="progress"><div id="bar"></div></div>
<div id="progressText" style="text-align:right;margin-bottom:10px;font-weight:600;color:var(--muted)">Frage 1 von 12</div>

<form action="https://formspree.io/f/mzddpkee" method="POST">
<input type="hidden" name="participant_id" id="pid">
<input type="hidden" name="ts_startSurvey" id="ts1">
<input type="hidden" name="ts_startVideo" id="ts2">
<input type="hidden" name="ts_endVideo" id="ts3">
<input type="hidden" name="ts_endSurvey" id="ts4">

<!-- SCHRITTE 1–12 -->
<!-- Schritt 1 -->
<div class="survey-step active">
<h3>1. Alter</h3>
<label><input type="radio" name="Alter" value="<18"> unter 18</label>
<label><input type="radio" name="Alter" value="18-29"> 18–29</label>
<label><input type="radio" name="Alter" value="30-44"> 30–44</label>
<label><input type="radio" name="Alter" value="45-59"> 45–59</label>
<label><input type="radio" name="Alter" value="60+"> 60+</label>
<button type="button" onclick="next()">Weiter</button>
</div>

<!-- Schritt 2 -->
<div class="survey-step">
<h3>2. Hören Sie regelmäßig Musik zur Entspannung?</h3>
<label><input type="radio" name="Musik" value="häufig"> ja, häufig</label>
<label><input type="radio" name="Musik" value="gelegentlich"> gelegentlich</label>
<label><input type="radio" name="Musik" value="selten"> selten</label>
<label><input type="radio" name="Musik" value="nie"> nie</label>
<button type="button" onclick="next()">Weiter</button>
</div>

<!-- Schritt 3 -->
<div class="survey-step">
<h3>3. Haben Sie bereits Erfahrung mit Entspannungsmethoden? (Mehrfachauswahl möglich)</h3>
<label><input type="checkbox" name="Methoden" value="Musik"> Musik</label>
<label><input type="checkbox" name="Methoden" value="Meditation"> Meditation</label>
<label><input type="checkbox" name="Methoden" value="Atemübungen"> Atemübungen</label>
<label><input type="checkbox" name="Methoden" value="Yoga"> Yoga</label>
<label><input type="checkbox" name="Methoden" value="keine"> keine</label>
<label><input type="checkbox" id="sonstigesCheck"> Sonstiges: <input type="text" id="sonstigesText" name="Methoden_Sonstiges" disabled></label>
<button type="button" onclick="next()">Weiter</button>
</div>

<!-- Schritt 4 -->
<div class="survey-step">
<h3>4. Wie gestresst haben Sie sich vor dem Ansehen des Films gefühlt? (1 = gar nicht | 5 = sehr)</h3>
<label><input type="radio" name="StressVor" value="1">1</label>
<label><input type="radio" name="StressVor" value="2">2</label>
<label><input type="radio" name="StressVor" value="3">3</label>
<label><input type="radio" name="StressVor" value="4">4</label>
<label><input type="radio" name="StressVor" value="5">5</label>
<button type="button" onclick="next()">Weiter</button>
</div>

<!-- Schritt 5 -->
<div class="survey-step">
<h3>5. Wie aufmerksam und aufnahmefähig haben Sie sich vor dem Film gefühlt?</h3>
<label><input type="radio" name="Aufmerksamkeit" value="sehr gering"> sehr gering</label>
<label><input type="radio" name="Aufmerksamkeit" value="eher gering"> eher gering</label>
<label><input type="radio" name="Aufmerksamkeit" value="mittel"> mittel</label>
<label><input type="radio" name="Aufmerksamkeit" value="eher hoch"> eher hoch</label>
<label><input type="radio" name="Aufmerksamkeit" value="sehr hoch"> sehr hoch</label>
<button type="button" onclick="next()">Weiter</button>
</div>

<!-- Schritt 6: Video -->
<div class="survey-step">
<h3>6. Bitte sehen Sie den Film vollständig an</h3>
<video id="video" controls>
<source src="entspannungsfilm.mov" type="video/mp4">
Ihr Browser unterstützt dieses Video nicht.
</video>
<button id="videoBtn" type="button" disabled onclick="next()">Weiter</button>
</div>

<!-- Schritt 7 -->
<div class="survey-step">
<h3>7. Wie entspannt fühlen Sie sich nach dem Ansehen des Films? (1 = gar nicht | 5 = sehr)</h3>
<label><input type="radio" name="Entspannung" value="1">1</label>
<label><input type="radio" name="Entspannung" value="2">2</label>
<label><input type="radio" name="Entspannung" value="3">3</label>
<label><input type="radio" name="Entspannung" value="4">4</label>
<label><input type="radio" name="Entspannung" value="5">5</label>
<button type="button" onclick="next()">Weiter</button>
</div>

<!-- Schritt 8 -->
<div class="survey-step">
<h3>8. Hat sich Ihr Stresslevel durch den Film verändert?</h3>
<label><input type="radio" name="StressChange" value="deutlich verringert"> deutlich verringert</label>
<label><input type="radio" name="StressChange" value="leicht verringert"> leicht verringert</label>
<label><input type="radio" name="StressChange" value="unverändert"> unverändert</label>
<label><input type="radio" name="StressChange" value="leicht erhöht"> leicht erhöht</label>
<label><input type="radio" name="StressChange" value="deutlich erhöht"> deutlich erhöht</label>
<button type="button" onclick="next()">Weiter</button>
</div>

<!-- Schritt 9 -->
<div class="survey-step">
<h3>9. Wie angenehm empfanden Sie die Musik?</h3>
<label><input type="radio" name="MusikAng" value="sehr unangenehm"> sehr unangenehm</label>
<label><input type="radio" name="MusikAng" value="eher unangenehm"> eher unangenehm</label>
<label><input type="radio" name="MusikAng" value="neutral"> neutral</label>
<label><input type="radio" name="MusikAng" value="eher angenehm"> eher angenehm</label>
<label><input type="radio" name="MusikAng" value="sehr angenehm"> sehr angenehm</label>
<button type="button" onclick="next()">Weiter</button>
</div>

<!-- Schritt 10 -->
<div class="survey-step">
<h3>10. Wie angenehm empfanden Sie die Bildsequenzen?</h3>
<label><input type="radio" name="BildAng" value="sehr unangenehm"> sehr unangenehm</label>
<label><input type="radio" name="BildAng" value="eher unangenehm"> eher unangenehm</label>
<label><input type="radio" name="BildAng" value="neutral"> neutral</label>
<label><input type="radio" name="BildAng" value="eher angenehm"> eher angenehm</label>
<label><input type="radio" name="BildAng" value="sehr angenehm"> sehr angenehm</label>
<button type="button" onclick="next()">Weiter</button>
</div>

<!-- Schritt 11 -->
<div class="survey-step">
<h3>11. Die Kombination aus Musik und Bildern wirkte auf mich entspannend</h3>
<label><input type="radio" name="Kombi" value="stimme gar nicht zu"> stimme gar nicht zu</label>
<label><input type="radio" name="Kombi" value="stimme eher nicht zu"> stimme eher nicht zu</label>
<label><input type="radio" name="Kombi" value="teils/teils"> teils / teils</label>
<label><input type="radio" name="Kombi" value="stimme eher zu"> stimme eher zu</label>
<label><input type="radio" name="Kombi" value="stimme voll zu"> stimme voll zu</label>
<button type="button" onclick="next()">Weiter</button>
</div>

<!-- Schritt 12 -->
<div class="survey-step">
<h3>12. Während des Films konnte ich gedanklich abschalten</h3>
<label><input type="radio" name="Abschalten" value="stimme gar nicht zu"> stimme gar nicht zu</label>
<label><input type="radio" name="Abschalten" value="stimme eher nicht zu"> stimme eher nicht zu</label>
<label><input type="radio" name="Abschalten" value="teils/teils"> teils / teils</label>
<label><input type="radio" name="Abschalten" value="stimme eher zu"> stimme eher zu</label>
<label><input type="radio" name="Abschalten" value="stimme voll zu"> stimme voll zu</label>
<button type="submit" onclick="finish()">Absenden</button>
</div>

</form>
</div>
</div>
</div>

<script>
// Elemente
const consentCheck = document.getElementById("consentCheck");
const consentBtn = document.getElementById("consentBtn");
const sonstigesCheck = document.getElementById("sonstigesCheck");
const sonstigesText = document.getElementById("sonstigesText");
const steps = document.querySelectorAll(".survey-step");
const bar = document.getElementById("bar");
const progressText = document.getElementById("progressText");
const video = document.getElementById("video");
const videoBtn = document.getElementById("videoBtn");
const pid = document.getElementById("pid");
const ts1 = document.getElementById("ts1");
const ts2 = document.getElementById("ts2");
const ts3 = document.getElementById("ts3");
const ts4 = document.getElementById("ts4");

// Sonstiges aktivieren
sonstigesCheck.addEventListener("change", ()=>{
  sonstigesText.disabled = !sonstigesCheck.checked;
  if(!sonstigesCheck.checked) sonstigesText.value="";
});

// DSGVO Button
consentCheck.addEventListener("change", ()=>{
  consentBtn.disabled = !consentCheck.checked;
});

// Sicherer Tagescode
function getDailyCode(){
  const stored = JSON.parse(localStorage.getItem("dailyCode") || "{}");
  const today = new Date().toISOString().slice(0,10);
  if(stored.date===today) return stored.code;
  const chars='ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
  let code='';
  for(let i=0;i<10;i++) code += chars.charAt(Math.floor(Math.random()*chars.length));
  localStorage.setItem("dailyCode",JSON.stringify({date:today,code:code}));
  return code;
}

// E-Mail unabhängig senden
function sendEmailOnly(){
  const email = document.getElementById("emailInput").value.trim();
  if(!email){alert("Bitte E-Mail eingeben!"); return;}
  fetch("https://formspree.io/f/mojjabdd",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({email:email,code:getDailyCode()})
  }).then(()=>alert("E-Mail gesendet!")).catch(()=>alert("Fehler!"));
}

// Code prüfen + App starten
function checkCode(){
  const entered = document.getElementById("codeInput").value.trim();
  const backdoor = "WP*furzteufel";
  if(entered===getDailyCode() || entered===backdoor){
    document.getElementById("codeScreen").style.display="none";
    document.getElementById("app").style.display="block";
    document.getElementById("consent").style.display="block";
  } else { alert("Falscher Code für heute!"); }
}

// Consent akzeptieren
function acceptConsent(){
  document.getElementById("consent").style.display="none";
  startSurvey();
}

// Navigation
function showPage(id){
  document.getElementById("start").style.display="none";
  document.getElementById("downloads").style.display="none";
  document.getElementById("survey").style.display="none";
  document.getElementById(id).style.display="block";
}

// Teilnehmer-ID persistent
function getOrCreateParticipantID(){
  let pidVal = localStorage.getItem("participant_id");
  if(!pidVal){
    pidVal="P-"+Math.random().toString(36).substring(2,8).toUpperCase();
    localStorage.setItem("participant_id",pidVal);
  }
  return pidVal;
}

// Survey
let step=0;
function startSurvey(){
  showPage("survey");
  step=0;
  steps.forEach(s=>s.classList.remove("active"));
  steps[0].classList.add("active");
  ts1.value=new Date().toISOString();
  pid.value=getOrCreateParticipantID();
  updateProgress();
}

function next(){
  const currentStep=steps[step];
  const inputs=currentStep.querySelectorAll("input");
  if(inputs.length){
    const valid=[...inputs].some(i=>{
      if(i.type==="radio"||i.type==="checkbox") return i.checked;
      else if(i.type==="text") return i.value.trim()!=="";
      return false;
    });
    if(!valid){ alert("Bitte beantworten Sie die Frage, bevor Sie fortfahren!"); return; }
  }
  currentStep.classList.remove("active");
  step++;
  if(step<steps.length) steps[step].classList.add("active");
  updateProgress();
}

function updateProgress(){
  bar.style.width=((step+1)/steps.length*100)+"%";
  progressText.innerText=`Frage ${step+1} von ${steps.length}`;
}

// Video Timestamps
video.onplay = () => ts2.value = new Date().toISOString();
video.onended = () => { ts3.value = new Date().toISOString(); videoBtn.disabled=false; };

// Finish
function finish(){ ts4.value = new Date().toISOString(); }

</script>
</body>
</html>
