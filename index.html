<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Entspannungsstudie</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root{--bg:#f6f8fb;--card:#fff;--accent:#2563eb;--accent2:#1e40af;--muted:#6b7280;--success:#16a34a;--danger:#ef4444}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,system-ui,sans-serif;background:linear-gradient(180deg,var(--bg),#fff);color:#0f172a}
.container{max-width:1000px;margin:40px auto;padding:20px}
.card{background:#fff;padding:32px;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.06);margin-bottom:24px}
h1,h2,h3{margin-top:0}
label{display:block;margin:10px 0;color:var(--muted)}
input[type=text],input[type=email],input[type=password]{width:100%;padding:12px;border-radius:10px;border:1px solid #e5e7eb}
button{padding:12px 18px;border:none;border-radius:10px;font-weight:700;cursor:pointer}
.primary{background:var(--accent);color:#fff}
button:disabled{opacity:.6;cursor:not-allowed}
.status{margin-top:10px;font-size:14px}
.success{color:var(--success)}
.error{color:var(--danger)}
.progress{height:12px;background:#e5e7eb;border-radius:20px;overflow:hidden;margin-bottom:10px}
.progress div{height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--accent2));transition:.4s}
.survey-step{display:none}
.survey-step.active{display:block}
video{width:100%;border-radius:14px;margin-top:15px}
.nav{display:flex;gap:20px;margin-bottom:20px}
.nav button{background:none;color:var(--accent);padding:0}
.small{font-size:13px;color:var(--muted)}
</style>
</head>
<body>
<div class="container">

<!-- LOGIN -->
<div id="loginCard" class="card">
<h1>Zugangscode erhalten und aktivieren</h1>
<p class="small">Bitte beachten Sie, dass dies ein privates Projekt ist und daher nur eingeschränkt öffentlich ist. Die E-Mail wird geprüft und nur an bekannte Personen gesendet.</p>
<label>Code anfordern</label>
<input id="emailInput" type="email" placeholder="name@beispiel.de">
<button class="primary" id="emailBtn">Code per E-Mail anfordern</button>
<div id="emailStatus" class="status"></div>
<hr style="margin:25px 0;border:none;border-top:1px solid #eee;">
<label>Zugriffscode eingeben</label>
<input id="codeInput" type="password" placeholder="Code">
<button class="primary" id="checkBtn">Weiter zur eigentlichen Seite</button>
<div id="codeStatus" class="status"></div>
</div>

<!-- STUDIEN-APP -->
<div id="app" style="display:none">
<div class="nav">
  <button onclick="showPage('start')">Startseite</button>
  <button onclick="startSurvey()">Umfrage</button>
  <button onclick="showPage('erklaerung')">Erklärung</button>
</div>

<!-- STARTSEITE -->
<div id="start" class="card">
<h2>Willkommen zur Entspannungsstudie</h2>
<p>Vielen Dank für Ihre Teilnahme.</p>
</div>

<!-- ERKLÄRUNG -->
<div id="erklaerung" class="card" style="display:none">
<h2>Erklärung zur Entspannungsstudie</h2>
<p>Diese Studie untersucht, wie sich verschiedene Entspannungsmethoden, wie Musik oder visuelle Inhalte, auf das Stresslevel und die Aufmerksamkeit auswirken. Ihre Teilnahme ist freiwillig und die Daten werden anonymisiert gesammelt.</p>
<p>Bitte beantworten Sie die Fragen ehrlich und vollständig. Die Ergebnisse dienen ausschließlich wissenschaftlichen Zwecken.</p>
<p>Bei Fragen wenden Sie sich bitte an den Projektleiter.</p>
</div>

<!-- UMFRAGE -->
<div id="survey" class="card" style="display:none">
<div class="progress"><div id="bar"></div></div>
<div id="progressText" class="small" style="text-align:right">Frage 1</div>
<form action="https://formspree.io/f/mzddpkee" method="POST">
<input type="hidden" name="participant_id" id="pid">
<input type="hidden" name="ts_startSurvey" id="ts1">
<input type="hidden" name="ts_startVideo" id="ts2">
<input type="hidden" name="ts_endVideo" id="ts3">
<input type="hidden" name="ts_endSurvey" id="ts4">

<!-- SCHRITTE 1–12 -->

<div class="survey-step active">
<h3>1. Alter</h3>
<label><input type="radio" name="Alter" value="<18">unter 18</label>
<label><input type="radio" name="Alter" value="18-29">18–29</label>
<label><input type="radio" name="Alter" value="30-44">30–44</label>
<label><input type="radio" name="Alter" value="45-59">45–59</label>
<label><input type="radio" name="Alter" value="60+">60+</label>
<button type="button" onclick="next()">Weiter</button>
</div>

<div class="survey-step">
<h3>2. Hören Sie regelmäßig Musik zur Entspannung?</h3>
<label><input type="radio" name="Musik" value="häufig">ja, häufig</label>
<label><input type="radio" name="Musik" value="gelegentlich">gelegentlich</label>
<label><input type="radio" name="Musik" value="selten">selten</label>
<label><input type="radio" name="Musik" value="nie">nie</label>
<button type="button" onclick="next()">Weiter</button>
</div>

<div class="survey-step">
<h3>3. Erfahrung mit Entspannungsmethoden (Mehrfachauswahl)</h3>
<label><input type="checkbox" name="Methoden" value="Musik">Musik</label>
<label><input type="checkbox" name="Methoden" value="Meditation">Meditation</label>
<label><input type="checkbox" name="Methoden" value="Atemübungen">Atemübungen</label>
<label><input type="checkbox" name="Methoden" value="Yoga">Yoga</label>
<label><input type="checkbox" name="Methoden" value="keine">keine</label>
<label><input type="checkbox" id="sonstigesCheck"> Sonstiges: <input type="text" id="sonstigesText" name="Methoden_Sonstiges" disabled></label>
<button type="button" onclick="next()">Weiter</button>
</div>

<div class="survey-step">
<h3>4. Stress vor Film (1–5)</h3>
<label><input type="radio" name="StressVor" value="1">1</label>
<label><input type="radio" name="StressVor" value="2">2</label>
<label><input type="radio" name="StressVor" value="3">3</label>
<label><input type="radio" name="StressVor" value="4">4</label>
<label><input type="radio" name="StressVor" value="5">5</label>
<button type="button" onclick="next()">Weiter</button>
</div>

<div class="survey-step">
<h3>5. Aufmerksamkeit vor Film</h3>
<label><input type="radio" name="Aufmerksamkeit" value="sehr gering">sehr gering</label>
<label><input type="radio" name="Aufmerksamkeit" value="eher gering">eher gering</label>
<label><input type="radio" name="Aufmerksamkeit" value="mittel">mittel</label>
<label><input type="radio" name="Aufmerksamkeit" value="eher hoch">eher hoch</label>
<label><input type="radio" name="Aufmerksamkeit" value="sehr hoch">sehr hoch</label>
<button type="button" onclick="next()">Weiter</button>
</div>

<div class="survey-step">
<h3>6. Film ansehen</h3>
<video id="video" controls>
<source src="entspannungsfilm.mov" type="video/mp4">
</video>
<button id="videoBtn" type="button" disabled onclick="next()">Weiter</button>
</div>

<div class="survey-step">
<h3>7. Entspannung nach Film (1–5)</h3>
<label><input type="radio" name="Entspannung" value="1">1</label>
<label><input type="radio" name="Entspannung" value="2">2</label>
<label><input type="radio" name="Entspannung" value="3">3</label>
<label><input type="radio" name="Entspannung" value="4">4</label>
<label><input type="radio" name="Entspannung" value="5">5</label>
<button type="button" onclick="next()">Weiter</button>
</div>

<div class="survey-step">
<h3>8. Veränderung Stresslevel</h3>
<label><input type="radio" name="StressChange" value="deutlich verringert">deutlich verringert</label>
<label><input type="radio" name="StressChange" value="leicht verringert">leicht verringert</label>
<label><input type="radio" name="StressChange" value="unverändert">unverändert</label>
<label><input type="radio" name="StressChange" value="leicht erhöht">leicht erhöht</label>
<label><input type="radio" name="StressChange" value="deutlich erhöht">deutlich erhöht</label>
<button type="button" onclick="next()">Weiter</button>
</div>

<div class="survey-step">
<h3>9. Musikempfinden</h3>
<label><input type="radio" name="MusikAng" value="sehr unangenehm">sehr unangenehm</label>
<label><input type="radio" name="MusikAng" value="eher unangenehm">eher unangenehm</label>
<label><input type="radio" name="MusikAng" value="neutral">neutral</label>
<label><input type="radio" name="MusikAng" value="eher angenehm">eher angenehm</label>
<label><input type="radio" name="MusikAng" value="sehr angenehm">sehr angenehm</label>
<button type="button" onclick="next()">Weiter</button>
</div>

<div class="survey-step">
<h3>10. Bildsequenzen</h3>
<label><input type="radio" name="BildAng" value="sehr unangenehm">sehr unangenehm</label>
<label><input type="radio" name="BildAng" value="eher unangenehm">eher unangenehm</label>
<label><input type="radio" name="BildAng" value="neutral">neutral</label>
<label><input type="radio" name="BildAng" value="eher angenehm">eher angenehm</label>
<label><input type="radio" name="BildAng" value="sehr angenehm">sehr angenehm</label>
<button type="button" onclick="next()">Weiter</button>
</div>

<div class="survey-step">
<h3>11. Kombination Musik + Bilder entspannend?</h3>
<label><input type="radio" name="Kombi" value="stimme gar nicht zu">stimme gar nicht zu</label>
<label><input type="radio" name="Kombi" value="stimme eher nicht zu">stimme eher nicht zu</label>
<label><input type="radio" name="Kombi" value="teils/teils">teils / teils</label>
<label><input type="radio" name="Kombi" value="stimme eher zu">stimme eher zu</label>
<label><input type="radio" name="Kombi" value="stimme voll zu">stimme voll zu</label>
<button type="button" onclick="next()">Weiter</button>
</div>

<div class="survey-step">
<h3>12. Während des Films gedanklich abschalten?</h3>
<label><input type="radio" name="Abschalten" value="stimme gar nicht zu">stimme gar nicht zu</label>
<label><input type="radio" name="Abschalten" value="stimme eher nicht zu">stimme eher nicht zu</label>
<label><input type="radio" name="Abschalten" value="teils/teils">teils / teils</label>
<label><input type="radio" name="Abschalten" value="stimme eher zu">stimme eher zu</label>
<label><input type="radio" name="Abschalten" value="stimme voll zu">stimme voll zu</label>
<button type="submit" onclick="finish()">Absenden</button>
</div>

</form>
</div>
</div>
</div>

<script>
function getDailyCode(){
    const s = JSON.parse(localStorage.getItem('dailyCode')||'{}');
    const t = new Date().toISOString().slice(0,10);
    if(s.date===t) return s.code;
    const c='ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
    let code='';
    for(let i=0;i<8;i++) code+=c[Math.floor(Math.random()*c.length)];
    localStorage.setItem('dailyCode',JSON.stringify({date:t,code}));
    return code;
}

emailBtn.onclick=async()=>{
    const e=emailInput.value.trim();
    if(!e){
        emailStatus.textContent='E-Mail eingeben';
        emailStatus.className='status error';
        return;
    }
    const p=new URLSearchParams();
    p.append('email',e);
    p.append('code',getDailyCode());
    await fetch('https://formspree.io/f/mzddpkee',{method:'POST',body:p,headers:{Accept:'application/json'}});
    emailStatus.textContent='Code gesendet';
    emailStatus.className='status success';
}

checkBtn.onclick=()=>{
    if(codeInput.value.trim()===getDailyCode()){
        loginCard.style.display='none';
        app.style.display='block';
    } else {
        codeStatus.textContent='Falscher Code';
        codeStatus.className='status error';
    }
}

function showPage(id){
    const pages = ['start','survey','erklaerung'];
    pages.forEach(p => document.getElementById(p).style.display='none');
    document.getElementById(id).style.display='block';
}

let step=0;
const steps=document.querySelectorAll('.survey-step');
const bar=document.getElementById('bar');
const progressText=document.getElementById('progressText');

function startSurvey(){
    showPage('survey');
    step=0;
    steps.forEach(s=>s.classList.remove('active'));
    steps[0].classList.add('active');
    ts1.value=new Date().toISOString();
    pid.value='P-'+Math.random().toString(36).slice(2,8).toUpperCase();
    updateProgress();
}

function next(){
    steps[step].classList.remove('active');
    step++;
    steps[step].classList.add('active');
    updateProgress();
}

function updateProgress(){
    bar.style.width=((step+1)/steps.length*100)+'%';
    progressText.innerText='Frage '+(step+1)+' von '+steps.length;
}

video.onplay=()=>ts2.value=new Date().toISOString();
video.onended=()=>{
    ts3.value=new Date().toISOString();
    videoBtn.disabled=false;
}

function finish(){ts4.value=new Date().toISOString();}

const sonstigesCheck=document.getElementById('sonstigesCheck');
const sonstigesText=document.getElementById('sonstigesText');
sonstigesCheck.addEventListener('change',()=>{
    sonstigesText.disabled=!sonstigesCheck.checked;
    if(!sonstigesCheck.checked) sonstigesText.value='';
});
</script>
</body>
</html>
